{% extends "base.html" %}
{% block content %}
<h3>Set Graphical Password for {{ app_name }}</h3>

<form method="POST" onsubmit="return submitSequence();">
  <label>Select Category:</label>
  <select name="category" id="category" required onchange="loadImages()">
    <option value="">--Choose--</option>
    <option value="emojis">Emojis</option>
    <option value="fruits">Fruits</option>
    <option value="flowers">Flowers</option>
  </select><br><br>

  <div id="image-grid" style="display:grid; grid-template-columns: repeat(3, 100px); gap:10px;"></div>

  <input type="hidden" name="password_seq" id="password_seq">
  <br><button type="submit">Set Password</button>
</form>

<script>
  let selected = [];

  function loadImages() {
    selected = [];
    document.getElementById("password_seq").value = "";
    const category = document.getElementById("category").value;
    const grid = document.getElementById("image-grid");
    grid.innerHTML = "";

    for (let i = 1; i <= 9; i++) {
      const img = document.createElement("img");
      img.src = "/static/images/" + category + "/" + i + ".png";
      img.style.width = "100px";
      img.style.border = "2px solid gray";
      img.style.cursor = "pointer";
      img.onclick = () => selectImage(i, img);
      grid.appendChild(img);
    }
  }

  function selectImage(index, imgElement) {
    if (selected.includes(index)) return;  // avoid duplicate
    selected.push(index);
    imgElement.style.border = "4px solid green";
  }

  function submitSequence() {
    if (selected.length < 3) {
      alert("Please select at least 3 images.");
      return false;
    }
    document.getElementById("password_seq").value = selected.join(",");
    return true;
  }
</script>
{% endblock %}
