{% extends "base.html" %}
{% block content %}
<h3>Unlock {{ app_name }}</h3>

<form method="POST" onsubmit="return submitSequence();">
    <div id="image-grid" style="display:grid; grid-template-columns: repeat(3, 100px); gap:10px;"></div>

    <input type="hidden" name="password_seq" id="password_seq">
    <br><button type="submit">Unlock</button>
</form>

<script>
    let selected = [];
    const category = "{{ category }}";

    window.onload = function () {
        const grid = document.getElementById("image-grid");
        for (let i = 1; i <= 9; i++) {
            const img = document.createElement("img");
            img.src = "/static/images/" + category + "/" + i + ".png";
            img.style.width = "100px";
            img.style.border = "2px solid gray";
            img.style.cursor = "pointer";
            img.onclick = () => selectImage(i, img);
            grid.appendChild(img);
        }
    }

    function selectImage(index, imgElement) {
        if (selected.includes(index)) return;
        selected.push(index);
        imgElement.style.border = "4px solid green";
    }

    function submitSequence() {
        if (selected.length < 3) {
            alert("Select at least 3 images.");
            return false;
        }
        document.getElementById("password_seq").value = selected.join(",");
        return true;
    }
</script>
{% endblock %}